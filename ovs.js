import{FunctionGraph as e,setupAudio as t,setupPlayerControls as n}from"./common.js";window.addEventListener("load",()=>{const o=new e(document.getElementById("funccanvas"));o.ylim=[-130,0],t("ovsproc.js","ovs-processor").then(e=>{e.proc.w=16,e.proc.dithertype="rect",e.proc.noiseshapingfilter=1,e.proc.oversamplingfactor=4,n(e,[{type:"sine"},{type:"remote",label:"Music",url:"audio/unfinite_function.mp3"}]);const t=new Float32Array(e.getFrequencyDomainData());for(let e=0;e<t.length;e++)t[e]=22050*e/(t.length-1);const i=new Float32Array(e.getTimeDomainData());for(let e=0;e<i.length;e++)i[e]=e;let c=!1;!function n(){setTimeout(()=>requestAnimationFrame(n),40),c?o.drawData(i,e.getTimeDomainData()):o.drawData(t,e.getFrequencyDomainData())}();const d=document.getElementById("linear");function a(e){c=e,e?(o.logx=!1,o.ylim=[-1,1],o.xlim=[0,i.length-1],o.xlabel="time in samples",o.ylabel="amplitude",d.style.visibility="hidden",d.labels[0].style.visibility="hidden"):(o.xlim=[50,2e4],o.logx=!d.checked,o.ylim=[-130,0],o.xlabel="frequency in Hz",o.ylabel="magnitude in dB",d.style.visibility="visible",d.labels[0].style.visibility="visible")}function l(){document.getElementById("dither").checked?document.getElementById("noiseshaping").checked?document.getElementById("diagram").src="images/ovs/ns5.png":document.getElementById("diagram").src="images/ovs/ns5b.png":document.getElementById("noiseshaping").checked?document.getElementById("diagram").src="images/ovs/ns5c.png":document.getElementById("diagram").src="images/ovs/ns5d.png"}function m(){document.getElementById("dither").checked?e.proc.dithertype=document.getElementById("dithertype").value:e.proc.dithertype="none",l()}function g(){document.getElementById("noiseshaping").checked?e.proc.noiseshapingfilter=document.getElementById("noiseshapingfilter").value:e.proc.noiseshapingfilter=0,l()}d.checked=!1,d.onchange=function(e){c||(o.logx=!e.target.checked)},document.getElementById("spectrum").onchange=(e=>{a(!e.target.checked)}),document.getElementById("waveform").onchange=(e=>{a(e.target.checked)}),a(!1),document.getElementById("wordlength").value=16,document.getElementById("wordlength").onchange=function(t){e.proc.w=t.target.value},document.getElementById("dither").checked=!0,document.getElementById("dither").onchange=m,document.getElementById("noiseshaping").checked=!0,document.getElementById("noiseshaping").onchange=g,document.getElementById("dithertype").value="rect",document.getElementById("dithertype").onchange=m,document.getElementById("noiseshapingfilter").value=1,document.getElementById("noiseshapingfilter").onchange=g,document.getElementById("oversamplingfactor").value=4,document.getElementById("oversamplingfactor").onchange=function(t){e.proc.oversamplingfactor=t.target.value}}).catch(e=>console.error(e))});