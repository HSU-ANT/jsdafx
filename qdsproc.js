class t extends AudioWorkletProcessor{constructor(t){super();const e=this;this.port.onmessage=s=>{"set-property"===s.data.action?e[s.data.param]=s.data.value:"list-properties"===s.data.action&&e.port.postMessage({response:"list-properties",properties:t})}}}registerProcessor("qds-processor",class extends t{constructor(){super(["w","dither","dithertype","noiseshaping","noiseshapingfilter"]),this.qt=.25,this.withDither=!1,this.ditherstate=new Float32Array(0),this.dithergen=this.rectDither,this.withNoiseShaping=!0,this.h=Float32Array.from([1]),this.nsState=new Array(0)}setChannelCount(t){if(this.ditherstate.length!==t&&(this.ditherstate=new Float32Array(t)),this.nsState.length!==t){this.nsState=new Array(t);for(let t=0;t<this.nsState.length;t++)this.nsState[t]=new Float32Array(this.h.length)}}set w(t){this.qt=Math.pow(2,1-t)}set dither(t){this.withDither=t}set dithertype(t){"rect"===t?this.dithergen=this.rectDither:"tri"===t?this.dithergen=this.triDither:"hp"===t&&(this.dithergen=this.hpDither,this.ditherstate=0)}set noiseshaping(t){this.withNoiseShaping=t}set noiseshapingfilter(t){1===(t=Number(t))?this.h=Float32Array.from([1]):2===t?this.h=Float32Array.from([2,-1]):3===t?this.h=Float32Array.from([1.623,-.982,.109]):5===t?this.h=Float32Array.from([2.033,-2.165,1.959,-1.59,.6149]):9===t&&(this.h=Float32Array.from([2.412,-3.37,3.937,-4.174,3.353,-2.205,1.281,-.569,.0847]));for(let t=0;t<this.nsState.length;t++)this.nsState[t]=new Float32Array(this.h.length)}rectDither(){return Math.random()-.5}triDither(){return Math.random()+Math.random()-1}hpDither(t){const e=Math.random()-.5,s=e-this.ditherstate[t];return this.ditherstate[t]=e,s}process(t,e){this.setChannelCount(t[0].length);for(let s=0;s<t[0].length;s++){const h=t[0][s],r=e[0][s];for(let t=0;t<h.length;t++){let e=h[t];if(this.withNoiseShaping)for(let t=0;t<this.h.length;t++)e-=this.h[t]*this.nsState[s][t];let i=0;this.withDither&&(i=this.dithergen(s));const a=this.qt*Math.round(e/this.qt+i);for(let t=this.h.length-1;t>=0;t--)this.nsState[s][t]=this.nsState[s][t-1];this.nsState[s][0]=a-e,r[t]=a}}return!0}});