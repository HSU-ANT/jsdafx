function e(e){const t=e.width,n=e.height,o=e.getContext("2d");let r=!0,i=2e4,a=50,s=null,l=0,c=-80,u=null,d=30;let f=17,p=null;const h=function(e){return(e-a)*(t-d)/i+d},g=function(e){return Math.log10(e/a)/Math.log10(i/a)*(t-d)+d};let m=g;const y=function(e){return 10+(n-10-f)/(c-l)*(e-l)},b=function(e){const t=Math.pow(10,Math.floor(Math.log10(e)));return(e/=t)>5?e=10:e>2?e=5:e>1&&(e=2),e*t},v=function(){o.clearRect(0,0,t,n),o.font="12px sans-serif",o.textBaseline="middle",o.textAlign="end";const e=b((i-a)/(t-d)*30),h=b((l-c)/(n-f-10)*20);for(let e=Math.floor(l/h)*h;e>=c;e-=h)o.strokeStyle="rgb(0, 0, 0)",o.fillText(e,d-2,y(e));if(o.textBaseline="top",o.textAlign="center",o.setTransform(0,-1,1,0,0,0),u&&o.fillText(u,-((n-f-10)/2+10),0),o.setTransform(1,0,0,1,0,0),r){o.strokeStyle="rgb(0, 0, 0)";for(let e=Math.pow(10,Math.ceil(Math.log10(a)));e<=i;e*=10)o.fillText(e,m(e),n-f+2)}else{o.strokeStyle="rgb(0, 0, 0)";for(let t=Math.ceil(a/e)*e;t<=i;t+=e)o.fillText(t,m(t),n-f+2)}s&&o.fillText(s,d+(t-d)/2,n-f+16);for(let e=Math.floor(l/h)*h;e>=c;e-=h)o.strokeStyle="rgb(100, 100, 100)",o.beginPath(),o.moveTo(m(a),y(e)),o.lineTo(m(i),y(e)),o.stroke();if(r){let e=Math.pow(10,Math.floor(Math.log10(a))),t=Math.ceil(a/e)*e;for(o.strokeStyle="rgb(100, 100, 100)";t<=i;){o.beginPath();const n=m(t);o.moveTo(n,y(l)),o.lineTo(n,y(c)),o.stroke(),(t+=e)>=9.99*e&&(e*=10)}}else for(let t=Math.ceil(a/e)*e;t<=i;t+=e){o.beginPath();const e=m(t);o.moveTo(e,y(l)),o.lineTo(e,y(c)),o.stroke()}o.rect(m(a),y(c),m(i)-m(a),y(l)-y(c)),o.stroke(),p=o.getImageData(0,0,t,n)};this.drawData=function(e,r){o.putImageData(p,0,0),o.strokeStyle="rgb(0, 0, 0)",o.save(),o.beginPath(),o.rect(d,10,t-d,n-f-10),o.clip(),o.beginPath(),o.moveTo(m(e[0]),y(r[0]));for(let t=1;t<r.length;t++)o.lineTo(m(e[t]),y(r[t]));o.stroke(),o.restore()},Object.defineProperty(this,"xlim",{get:()=>[a,a],set(e){[a,i]=e,v()}}),Object.defineProperty(this,"ylim",{get:()=>[c,c],set(e){[c,l]=e,v()}}),Object.defineProperty(this,"logx",{get:()=>r,set(e){m=(r=e)?g:h,v()}}),Object.defineProperty(this,"xlabel",{get:()=>s,set(e){f=(s=e)?30:16,v()}}),Object.defineProperty(this,"ylabel",{get:()=>u,set(e){d=(u=e)?44:30,v()}})}async function t(e,t){const n=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"playback"});let o=null,r=null;const i=n.createAnalyser();i.smoothingTimeConstant=.3,i.minDecibels=-130,i.fftSize=1024;const a=new Float32Array(i.fftSize),s=new Float32Array(i.frequencyBinCount);i.connect(n.destination);let l=function(){};await n.audioWorklet.addModule(e);const c=new AudioWorkletNode(n,t);c.port.postMessage({action:"list-properties"});const u=await(e=>new Promise(t=>{const n=e.onmessage;e.onmessage=(o=>{e.onmessage=n,t(o.data)})}))(c.port);if("list-properties"===u.response)for(const e of u.properties)Object.defineProperty(c,e,{set(t){c.port.postMessage({action:"set-property",param:e,value:t})}});const d=function(){null!==o&&(o.disconnect(),o=null),null!==r&&(r.disconnect(),r=null),c.disconnect(),n.suspend()};return d(),{start:function(e){d(),n.resume(),e instanceof AudioBuffer?((o=n.createBufferSource()).buffer=e,o.onended=(()=>{d(),l()}),o.start(),o.connect(c)):"sine"===e.type&&((o=n.createOscillator()).type="sine",o.frequency.value=e.frequency,o.start(),(r=n.createGain()).gain.value=e.gain,o.connect(r),r.connect(c)),c.connect(i)},stop:d,isPlaying:()=>null!==o,createBuffer:e=>new Promise(t=>{n.decodeAudioData(e,t)}),set onended(e){l=e},getTimeDomainData:function(){return i.getFloatTimeDomainData(a),a},getFrequencyDomainData:function(){return i.getFloatFrequencyData(s),s},proc:c}}function n(e,t){const n=[];let o=null;const r=document.getElementById("source-select"),i=r.children[1];r.children[0].addEventListener("click",e=>{e.stopPropagation(),i.style.visibility="visible"===i.style.visibility?"hidden":"visible"},!1),document.addEventListener("click",()=>{i.style.visibility="hidden"},!1);const a=document.getElementById("play"),s=document.getElementById("stop");function l(){e.isPlaying()?(a.disabled=!0,s.disabled=!1):(s.disabled=!0,a.disabled=!n[o])}function c(t){o=t.getAttribute("data-source-idx"),r.children[0].innerText=t.textContent,function e(t){t.classList.remove("selected"),Array.from(t.children).forEach(e)}(i),t.classList.add("selected"),e.stop(),l()}function u(e,t){e.innerText=t,e.getAttribute("data-source-idx")===o&&(r.children[0].innerText=t)}t.forEach(async function(t){const o=document.createElement("div");o.setAttribute("data-source-idx",n.length),i.children[0].append(o);const r=n.length;if(o.addEventListener("click",e=>{c(e.target)}),"remote"===t.type){o.innerText=`${t.label} (loading...)`,n.push(null);const i=await window.fetch(t.url);n[r]=await e.createBuffer(await i.arrayBuffer()),u(o,t.label)}else if("sine"===t.type){const e=t.frequency||440;o.innerText=t.label||`${e} Hz sine`,n.push({type:"sine",frequency:e,gain:t.gain||.5})}l()}),e.onended=l,s.onclick=function(){e.stop(),l()},a.onclick=function(){e.start(n[o]),l()};const d=i.children[1],f=d.children[0],p=document.createElement("input");p.type="file",p.accept="audio/*",p.addEventListener("change",async t=>{const o=t.target.files[0];if(!o)return;const r=document.createElement("div");r.setAttribute("data-source-idx",n.length),r.innerText=`${o.name} (loading...)`,c(r),d.insertBefore(r,f);const i=n.length;r.addEventListener("click",e=>{c(e.target)}),n.push(null);const a=await new Promise(e=>{const t=new FileReader;t.onload=(t=>{e(t.target.result)}),t.readAsArrayBuffer(o)}),s=await e.createBuffer(a);n[i]=s,u(r,o.name),l()},!1),0===t.length?r.children[0].innerText="input signal":c(i.children[0].children[0]),f.addEventListener("click",()=>{p.click()})}void 0===Math.log10&&(Math.log10=function(e){return Math.LOG10E*Math.log(e)}),void 0===AnalyserNode.prototype.getFloatTimeDomainData&&(AnalyserNode.prototype.getFloatTimeDomainData=function(e){const t=new Uint8Array(e.length);this.getByteTimeDomainData(t);for(let n=0;n<e.length;n++)e[n]=(t[n]-128)/128}),void 0===document.createElement("input").labels&&Object.defineProperty(HTMLInputElement.prototype,"labels",{get(){return document.querySelectorAll(`label[for=${this.id}]`)}});export{e as FunctionGraph,t as setupAudio,n as setupPlayerControls};!function(){var e,t=[];function n(e){var n=this,r={},i=-1;this.parameters.forEach(function(e,o){var a=t[++i]||(t[i]=new Float32Array(n.bufferSize));a.fill(e.value),r[o]=a}),this.processor.realm.exec("self.sampleRate=sampleRate="+this.context.sampleRate+";self.currentTime=currentTime="+this.context.currentTime);var a=o(e.inputBuffer),s=o(e.outputBuffer);this.instance.process([a],[s],r)}function o(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t}function r(e){return e.$$processors||(e.$$processors={})}"function"!=typeof AudioWorkletNode&&(self.AudioWorkletNode=function(t,o,i){var a=r(t)[o],s=t.createScriptProcessor(void 0,2,i&&i.outputChannelCount?i.outputChannelCount[0]:2);if(s.parameters=new Map,a.properties)for(var l=0;l<a.properties.length;l++){var c=a.properties[l],u=t.createGain().gain;u.value=c.defaultValue,s.parameters.set(c.name,u)}var d=new MessageChannel;e=d.port2;var f=new a.Processor(i||{});return e=null,s.port=d.port1,s.processor=a,s.instance=f,s.onaudioprocess=n,s},Object.defineProperty((self.AudioContext||self.webkitAudioContext).prototype,"audioWorklet",{get:function(){return this.$$audioWorklet||(this.$$audioWorklet=new self.AudioWorklet(this))}}),self.AudioWorklet=function(){function t(e){this.$$context=e}return t.prototype.addModule=function(t,n){var o=this;return fetch(t).then(function(e){if(!e.ok)throw Error(e.status);return e.text()}).then(function(t){var i={sampleRate:0,currentTime:0,AudioWorkletProcessor:function(){this.port=e},registerProcessor:function(e,t){r(o.$$context)[e]={realm:a,context:i,Processor:t,properties:t.parameterDescriptors||[]}}};i.self=i;var a=new function(e,t){var n=document.createElement("iframe");n.style.cssText="position:absolute;left:0;top:-999px;width:1px;height:1px;",t.appendChild(n);var o=n.contentWindow,r=o.document,i="var window,$hook";for(var a in o)a in e||"eval"===a||(i+=",",i+=a);for(var s in e)i+=",",i+=s,i+="=self.",i+=s;var l=r.createElement("script");l.appendChild(r.createTextNode('function $hook(self,console) {"use strict";\n        '+i+";return function() {return eval(arguments[0])}}")),r.body.appendChild(l),this.exec=o.$hook(e,console)}(i,document.documentElement);return a.exec((n&&n.transpile||String)(t)),null})},t}())}();